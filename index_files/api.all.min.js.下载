/** Order Api 1.0.3  下单js接口 Copyright 2017 正家文化  Released on: 2017-12-7  */
function addCookie(e,t,n){var o=e+"="+escape(t)+"; path=/";if(n>0){var r=new Date;r.setTime(r.getTime()+3600*n*1e3),o=o+";expires="+r.toGMTString()}document.cookie=o}function getCookie(e){for(var t=document.cookie.split("; "),n=0;n<t.length;n++){var o=t[n].split("=");if(o[0]==e)return unescape(o[1])}return null}function delCookie(e){var t=new Date;t.setTime(t.getTime()-1);var n=getCookie(e);null!=n&&(document.cookie=e+"="+n+"; path=/;expires="+t.toGMTString())}function getRequst(){window.location.search}function getHost(){return window.location.host}function getQueryString(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),n=window.location.search.substr(1).match(t);return null!=n?n[2]:""}function Site(){this.debug=!1,this.getTokenCount=0,this.ck=0,this.cp=""}!function(e,t,n){function o(){}o.ApiUrl=function(){var e=t.location.port,n=t.location.hostname,o=t.location.protocol;return n=o+"//"+n,"http:"==o&&80==e||"https:"==o&&443==e?name+"/":n+":"+e+"/"},o.buy=function(t){var n="&rd="+Math.random(),t=e.extend(!0,{type:"POST",dataType:"json",url:o.ApiUrl()+"Api.php?act=buy"+n},t);e.ajax(t)},o.orderInfo=function(t){var n="&rd="+Math.random(),t=e.extend(!0,{type:"POST",dataType:"json",url:o.ApiUrl()+"Api.php?act=orderInfo"+n},t);e.ajax(t)},o.productList=function(t){var n="&rd="+Math.random(),t=e.extend(!0,{type:"POST",dataType:"json",url:o.ApiUrl()+"Api.php?act=productList"+n},t);e.ajax(t)},o.siteInfo=function(t){var n="&rd="+Math.random(),t=e.extend(!0,{type:"POST",dataType:"json",url:o.ApiUrl()+"Api.php?act=siteInfo"+n},t);e.ajax(t)},o.token=function(t){var n="&rd="+Math.random(),t=e.extend(!0,{type:"POST",dataType:"json",url:"Api.php?act=token"+n},t);e.ajax(t)},o.hotMap=function(t){var n="&rd="+Math.random(),t=e.extend(!0,{type:"POST",dataType:"json",url:o.ApiUrl()+"Api.php?act=heatmap"+n},t);e.ajax(t)},o.stat=function(t){var n="&rd="+Math.random(),t=e.extend(!0,{type:"POST",dataType:"json",url:o.ApiUrl()+"Api.php?act=stat"+n},t);e.ajax(t)},o.pcs=function(t){var n="&rd="+Math.random(),t=e.extend(!0,{type:"POST",dataType:"json",url:o.ApiUrl()+"Api.php?act=pcs"+n},t);e.ajax(t)},e.extend(e,{Order:o})}(jQuery,window),Site.prototype={unloadHeatmap:function(){var e=this;$(window).unload(function(){e.cp&&$.Order.hotMap({data:{cp:e.cp},success:function(){e.cp=""}})})},initInfo:function(){$(".js-telphone").each(function(){siteInfo.telphone&&$(this).html(siteInfo.telphone),siteInfo.callTelphone&&$(this).attr("href","tel:"+siteInfo.callTelphone)}),siteInfo.callTelphone&&$(".js-call-telphone").each(function(){$(this).attr("href","tel:"+siteInfo.callTelphone)}),siteInfo.telphone&&$(".js-no-call-telphone").each(function(){$(this).html(siteInfo.telphone)}),siteInfo.company&&$(".js-copyright").html(siteInfo.company),siteInfo.weixinnumber && $('.js-weixinnumber').html(((siteInfo.weixinnumber).split(","))[Math.floor(Math.random() * (((siteInfo.weixinnumber).split(",")).length))]),siteInfo.weixinnumber2 && $('.js-weixinnumber2').html(((siteInfo.weixinnumber2).split(","))[Math.floor(Math.random() * (((siteInfo.weixinnumber2).split(",")).length))]),siteInfo.weixinnumber3 && $('.js-weixinnumber3').html(((siteInfo.weixinnumber3).split(","))[Math.floor(Math.random() * (((siteInfo.weixinnumber3).split(",")).length))]),siteInfo.weixinnumber&&$(".js-wximg").each(function(){$(this).attr("src","wxerweima/"+($(".js-weixinnumber").html())+".jpg")}),siteInfo.weixinnumber2&&$(".js-wximg2").each(function(){$(this).attr("src","wxerweima/"+($(".js-weixinnumber2").html())+".jpg")}),siteInfo.weixinnumber3&&$(".js-wximg3").each(function(){$(this).attr("src","wxerweima/"+($(".js-weixinnumber3").html())+".jpg")}),$(".js-indextitle").html(siteInfo.indextitle),$(".js-icp").html(siteInfo.icp),siteInfo.title&&(document.title=siteInfo.title),siteInfo.keyword&&$("head").find('meta[name="keywords"]').attr("content",siteInfo.keyword),siteInfo.description&&$("head").find('meta[name="description"]').attr("content",siteInfo.description)},isMobile:function(){var e=navigator.userAgent;return!!/(nokia|sony|ericsson|mot|samsung|sgh|lg|philips|panasonic|alcatel|lenovo|cldc|midp|mobile|android|iphone|ipad|phone|blackberry|opera mobi|opera mini)/i.test(e)},jump:function(){siteInfo.jump&&""!=siteInfo.jump&&(this.debug||(window.location.href=siteInfo.jump))},heatmap:function(){var e=this,t=arguments[0]?arguments[0]:6;$(document).click(function(n){e.ck++;var o=$(window).width(),r=$("body").height(),i=n.pageX,a=n.pageY;e.cp=e.cp+i+"*"+a+"*"+o+"*"+r+"|",e.ck>t&&(e.ck=0,$.Order.hotMap({data:{cp:e.cp},success:function(){e.cp=""}}))})},pcs:function(){for(var e=(arguments[0]?arguments[0]:"phone|tel400|consignee|nowbuy|buy|address|video").split("|"),t=0;t<e.length;t++)$('[pcs="'+e[t]+'"]').click(function(){var e=$(this).attr("pcs");$.Order.pcs({data:{url:document.location.href,type:e,channel:getCookie("channel")?getCookie("channel"):getQueryString("id")},success:function(){}})})},productList:function(e){if("function"!=typeof e)return console.log("参数必需是一个参数"),!1;var t=[];$(".js-checkbox").each(function(){var e=$(this).val();t.push(e)}),$.Order.productList({data:{product:t.join("|"),is_key:1},success:function(t){e(t)}})},getToken:function(){this.getTokenCount++;var e=(new Date).getTime();$.Order.token({data:{ts:e},success:function(e){0==e.errcode&&(siteInof.token=e.data.token)}})},registerCheckbox:function(e){var t=this;(e=$.extend(!0,{checkbox:$(".js-checkbox"),amountElement:$(".js-product-total"),callback:function(){}},e)).checkbox.click(function(){t.calcPrice(e)})},calcPrice:function(e){var t=0,n=[];(e=$.extend(!0,{checkbox:$(".js-checkbox"),amountElement:$(".js-product-total"),callback:function(){}},e)).checkbox.each(function(){if($(this).prop("checked")){n.push($(this));var e=$(this).data("price");t+=parseFloat(e)}}),e.callback&&"function"==typeof e.callback&&e.callback(n),e.amountElement.html(t.toFixed(2))},processForm:function(e){var t=(e=$.extend(!0,{mobileJump:$.Order.ApiUrl()+"successyd.html",pcJump:$.Order.ApiUrl()+"successpc.html"},e)).form,n=this,o=$.trim(t.find('[name="consignee"]').val()),r=$.trim(t.find('[name="phone"]').val()),i=$.trim(t.find('[name="address"]').val()),a=t.find('[name="verify_code"]').length>0?$.trim(t.find('[name="verify_code"]').val()):"",c=t.find('[name="remark"]').val(),s=[];if(t.find('[name="product"]').each(function(){if($(this).prop("checked")){var e={};e.sn=$(this).val();var n=t.find('[name="goods_number['+e.sn+']"]').val();n&&$.isNumeric(n)&&0!=n?e.quantity=n:e.quantity=1,s.push(e)}}),s.length<1)return alert("请选择版本！"),!1;if(o.length<=0)return alert("请填写姓名！"),!1;if(!/^[\u4e00-\u9fa5]{2,4}$/.test(o))return alert("请输入正确的姓名！"),!1;if(r.length<=0)return alert("请输入手机号码！"),!1;if(!/^1[3,4,5,6,8,7,9]\d{9}$/.test(r))return alert("请输入正确的手机号码！"),!1;var l=$.trim(t.find('[name="province"]').val()),u=$.trim(t.find('[name="city"]').val()),d=$.trim(t.find('[name="area"]').val());if(""==l)return alert("请选择省份！"),!1;if(""==u)return alert("请选择城市！"),!1;if(""==d)return alert("请选择县区！"),!1;if(i.length<=0)return alert("请填写地址！"),!1;if(c.length>255)return alert("备注不能大于255个字符！"),!1;if(1==siteInfo.is_verify&&""==a)return alert("请填写验证码！"),!1;var p=getCookie("referrer")?getCookie("referrer"):document.referrer,f=getCookie("channel")?getCookie("channel"):getQueryString("id"),h=$.extend({consignee:o,phone:r,address:l+u+d+i,verify_code:a,remark:c,product:s,referrer:p,channel:f},siteInfo),m=!1,v=new Object;if(e.url&&(v.url=e.url),v.data=h,v.success=function(t){if($(".js-now-buy").removeClass("on"),m=!1,0==t.errcode&&t.data.order_id){var o=t.data.order_id;addCookie("order_id",o),n.isMobile()?url=e.mobileJump+"?order_id="+o:url=e.pcJump+"?order_id="+o,e.callback&&e.callback(),n.debug?(console.log(h),console.log(t)):location.href=url}else if(2==t.errcode){if(that.processCount>0)return!1;that.getToken(),$(".js-verify-code")&&$(".js-verify-code").click(),alert(t.errmsg)}else alert(t.errmsg),$(".js-verify-code")&&$(".js-verify-code").click()},v.error=function(e){$(".js-now-buy").removeClass("on"),alert("网络错误！"),$(".js-verify-code").click()},$(".js-now-buy").hasClass("on"))return alert("正在处理中，请勿重复提交！"),!1;$(".js-now-buy").addClass("on"),m||$.Order.buy(v)}};